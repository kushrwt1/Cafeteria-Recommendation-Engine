CREATE DATABASE cafeteria_database; 
USE cafeteria_database; 
 
-- Roles Table 
CREATE TABLE Roles ( 
    role_id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    role_name VARCHAR(255) UNIQUE NOT NULL 
); 


-- Users Table 
CREATE TABLE Users ( 
    user_id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    name VARCHAR(255) NOT NULL, 
    password VARCHAR(255) NOT NULL, 
    role_id BIGINT, 
    FOREIGN KEY (role_id) REFERENCES Roles(role_id) ON DELETE SET NULL ON UPDATE CASCADE 
);


-- Meal Types Table 
CREATE TABLE Meal_Types ( 
    id INT AUTO_INCREMENT PRIMARY KEY, 
    meal_name VARCHAR(255) NOT NULL 
); 


-- Menu Item Table 
CREATE TABLE Menu_Items (
    menu_item_id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    name VARCHAR(255) NOT NULL, 
    availability BOOLEAN NOT NULL DEFAULT TRUE, 
    price DECIMAL(10, 2) NOT NULL, 
    meal_type_id INT, 
    FOREIGN KEY (meal_type_id) REFERENCES Meal_Types(id) ON DELETE CASCADE ON UPDATE CASCADE 
); 

ALTER TABLE Menu_Items 
ADD COLUMN dietary_type VARCHAR(50) NOT NULL DEFAULT 'Vegetarian', 
ADD COLUMN spice_level VARCHAR(50) NOT NULL DEFAULT 'Medium', 
ADD COLUMN cuisine_type VARCHAR(50) NOT NULL DEFAULT 'North Indian', 
ADD COLUMN is_sweet BOOLEAN NOT NULL DEFAULT FALSE;


-- Chef Daily Menus Table 
CREATE TABLE Chef_Daily_Menus ( 
    id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    menu_item_id BIGINT, 
    date DATE NOT NULL, 
    FOREIGN KEY (menu_item_id) REFERENCES Menu_Item(menu_item_id) ON DELETE CASCADE ON UPDATE CASCADE 
); 


-- Employee Menu Selections Table 
CREATE TABLE Employee_Menu_Selections ( 
    id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    user_id BIGINT, 
    menu_item_id BIGINT, 
    selection_date DATE NOT NULL, 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE ON UPDATE CASCADE, 
    FOREIGN KEY (menu_item_id) REFERENCES Menu_Item(menu_item_id) ON DELETE CASCADE ON UPDATE CASCADE 
); 


-- Notification Table 
CREATE TABLE Notifications ( 
    id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    message VARCHAR(255) NOT NULL, 
    user_id BIGINT, 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE ON UPDATE CASCADE 
); 


-- Feedback Table 
CREATE TABLE Feedback ( 
    id BIGINT AUTO_INCREMENT PRIMARY KEY, 
    comment VARCHAR(255) NOT NULL, 
    rating INT NOT NULL, 
    menu_item_id BIGINT, 
    user_id BIGINT, 
    FOREIGN KEY (menu_item_id) REFERENCES Menu_Item(menu_item_id) ON DELETE CASCADE ON UPDATE CASCADE, 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE ON UPDATE CASCADE 
); 

-- Discarded Food Item Feedback Table
CREATE TABLE Discarded_Food_Item_Feedback (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    menu_item_id BIGINT NOT NULL,
    dislikes TEXT,
    desired_taste TEXT,
    mom_recipe TEXT,
    feedback_date DATE NOT NULL,
    FOREIGN KEY (menu_item_id) REFERENCES menu_items(menu_item_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Discarded Menu Item Table
CREATE TABLE Discarded_Menu_Item (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    menu_item_id BIGINT NOT NULL,
    discarded_date DATE NOT NULL,
    name varchar(255 NOT NULL),
    FOREIGN KEY (menu_item_id) REFERENCES menu_items(menu_item_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- Employee Profile Table
CREATE TABLE Employee_Profile (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    dietary_preference VARCHAR(50) NOT NULL, -- Vegetarian, Non Vegetarian, Eggetarian
    spice_level VARCHAR(50) NOT NULL, -- High, Medium, Low
    cuisine_preference VARCHAR(50) NOT NULL, -- North Indian, South Indian, Other
    sweet_tooth BOOLEAN NOT NULL, -- Yes, No
    profile_update_date DATE NOT NULL,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- User activity table
CREATE TABLE user_activity (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    activity_type VARCHAR(255) NOT NULL,
    activity_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE ON UPDATE CASCADE
);